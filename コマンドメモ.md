<!-- omit in toc -->
# コマンドメモ

Docker や SQL Server の操作でよく使う基本的なコマンドや SQL をまとめています。

## 1. Docker

### 1.1. Docker コマンド

- Docker の起動確認・起動・停止

    ```shell
    > sudo service docker status                # 確認
    * Docker is not running

    > sudo service docker start                 # 起動する
    * Starting Docker: docker        [ OK ]

    > sudo service docker status                # こう表示されれば OK
    * Docker is running

    > sudo service docker stop                  # 止める場合はコレ
    * Stopping Docker: docker        [ OK ]
    ```

- 起動中の Docker Image を表示

    ```shell
    > docker ps
    ```

### 1.2. Docker Compose コマンド

- コンテナをバックグラウンドで起動

    ```shell
    > docker-compose up -d
    ```

- 起動しているコンテナに bash で入る

    ```shell
    > docker-compose exec main bash

    # 抜けるときは `exit` を送信する
    ```

- 起動しているコンテナを停止する

    ```shell
    > docker-compose stop
    ```

- 起動しているコンテナのログを表示する

    ```shell
    > docker-compose logs -f
    ```

- コンテナを削除する

    ```shell
    > docker-compose down
    ```

## 2. SQL Server

### 2.1. コンテナ上での操作

- SQL Server へログインする

    ```shell
    > sqlcmd -S localhost -U SA -P 'Test1234'
    ```

- ログイン + SQL をファイルから読みだして実行

    ```shell
    > sqlcmd -S localhost -U SA -P 'Test1234' -i /mount_dir/sql/show_databases.sql
    ```

### 2.2. データベース操作

実際に使えるコマンドは [mount_dir 上](mount_dir/sql/) へ格納。

- データベース一覧を取得する

    ```sql
    SELECT name FROM sys.databases ;
    GO
    ```

- データベースを作成する

    ```sql
    CREATE DATABASE <<database-name>> ;
    GO
    ```

- 使用するデータベースを設定する

    ```sql
    USE <<database-name>> ;
    GO
    ```

- 使用しているデータベースを確認する

    ```sql
    SELECT DB_NAME() ;
    GO
    ```

### 2.3. テーブル操作

- テーブル一覧を表示する

    ```sql
    SELECT name FROM sysobjects WHERE xtype = 'U' ;
    GO
    ```

- テーブルを作成する

    ```sql
    CREATE TABLE members (
        member_id int not null primary key,
        first_name varchar(50) null,
        last_name varchar(50) null,
        created_at datetime not null,
        updated_at datetime null
    )
    ;
    GO
    ```

- カラムの情報を表示する（全部出るのでめちゃ見づらい）

    ```sql
    SELECT * FROM sys.columns
    WHERE object_id = object_id('members')
    ;
    GO
    ```

- カラムの情報を表示する（カラム名 / PK / 型 / 長さ / NULL 許可）  
長いので切り分けています。  
[show_columns_info.sql](mount_dir/sql/show_columns_info.sql) を見てね。

### 2.4. レコード操作

- レコードを抽出する

    ```sql
    SELECT
        member_id,
        first_name,
    FROM members
    WHERE 条件
    ;
    GO

    -- よしなに書けばとりあえず動く
    ```

- レコードを追加する（1行）

    ```sql
    INSERT INTO members (
        member_id,
        first_name,
        last_name,
        created_at
    )
    VALUES (
        1,
        'modane',
        'sakura',
        '2021-01-01 00:00:00'
    )
    ;
    GO

    -- すべての列へ値を入れる際は members のカラム指定 (a, b, c, ...) を省略できる
    INSERT INTO members
    VALUES (
        1,
        'modane',
        'sakura',
        '2021-01-01 00:00:00',
        '2021-01-02 12:00:00'
    )
    ;
    GO

    ```

- 別テーブルから SELECT 句での抽出結果を追加する

    ```sql
    INSERT INTO members (
        member_id,
        first_name,
        last_name,
        created_at
    )
    SELECT
        member_id,
        first_name,
        last_name,
        created_at
    FROM members_sub
    WHERE 条件
    ;
    GO
    ```

- レコードを削除する

    ```sql
    DELETE
    FROM members
    WHERE 条件
    ;
    GO
    ```
